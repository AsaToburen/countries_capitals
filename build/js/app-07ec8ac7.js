angular.module("ccApp",["ngRoute","ngAnimate"]).constant("COUNTRIES_URL","http://api.geonames.org/countryInfoJSON").constant("SEARCH_PATH","http://api.geonames.org/searchJSON").constant("NEIGHBORS_PATH","http://api.geonames.org/neighboursJSON").factory("ccRequest",["$http","$q","COUNTRIES_URL","SEARCH_PATH","NEIGHBORS_PATH",function(r,e,t,n,o){var a={countries:[],getAll:function(){var n=e.defer();if(a.countries.length)return n.resolve(a.countries),n.promise;var o={cache:!0,params:{username:"atoburen"}},u=r.get(t,o);return u.success(function(r){var e=a.formatCountries(r);a.countries=e,n.resolve(e)}),n.promise},getCountry:function(n){var o=e.defer(),u={cache:!0,params:{lang:"en",username:"atoburen",country:n}},c=r.get(t,u);return c.success(function(r){var e=a.formatCountry(r);o.resolve(e)}),o.promise},getCapitals:function(t,o){var u=e.defer(),c={cache:!0,params:{lang:"en",username:"atoburen",q:o,name_equals:o,country:t,isNameRequired:!0}},s=r.get(n,c);return s.success(function(r){var e=a.formatCapitals(r);u.resolve(e)}),u.promise},getNeighbors:function(t){var n=e.defer(),u={cache:!0,params:{country:t,username:"atoburen"}},c=r.get(o,u);return c.success(function(r){var e=a.formatNeighbors(r);n.resolve(e)}),n.promise},formatCountries:function(r){var e=[];return angular.forEach(r.geonames,function(r){e.push({name:r.countryName,code:r.countryCode,capital:r.capital,area:r.areaInSqKm,population:r.population,continent:r.continentName})}),e},formatCountry:function(r){return 1===r.geonames.length?r.geonames[0]:!1},formatCapitals:function(r){var e=[];return angular.forEach(r.geonames,function(r){e.push(r)}),e},formatNeighbors:function(r){var e=[];return angular.forEach(r.geonames,function(r){e.push(r)}),e}};return a}]).config(["$routeProvider",function(r){r.when("/",{templateUrl:"home.html"}).when("/countries",{templateUrl:"./countries/countryHome.html",controller:"CountryCtrl",resolve:{countriesData:["ccRequest",function(r){return r.getAll()}]}}).when("/countries/:country/:capital",{templateUrl:"./countries/countryDetail.html",controller:"CountryDetailCtrl",resolve:{country:["$route","ccRequest",function(r,e){var t=r.current.params.country;return e.getCountry(t)}],capitals:["$route","ccRequest",function(r,e){var t=r.current.params.country,n=r.current.params.capital;return e.getCapitals(t,n)}],neighbors:["$route","ccRequest",function(r,e){var t=r.current.params.country;return e.getNeighbors(t)}]}}).when("/error",{template:"<p>Error Page Not Found</p>"}).otherwise({redirectTo:"/"})}]).run(function(r,e,t){r.$on("$routeChangeError",function(){e.path("/error")}),r.$on("$routeChangeStart",function(){r.isLoading=!0}),r.$on("$routeChangeSuccess",function(){t(function(){r.isLoading=!1},2e3)})}).controller("CountryCtrl",["$scope","countriesData",function(r,e){r.countries=e}]).controller("CountryDetailCtrl",["$scope","country","capitals","neighbors",function(r,e,t,n){r.country=e,r.capitals=t,r.neighbors=n}]);